version: 2

models:
  - name: mart_hourly_campaign_performance
    description: |
      Mart model for hourly campaign performance with business logic and performance flags.
      This model builds upon the intermediate layer and adds business-specific transformations,
      performance indicators, and additional time dimensions for analysis and reporting.

    config:
      materialized: table

    columns:
      # Business logic additions only - base fields and calculated metrics from intermediate
      - name: date_day
        description: Date truncated to day level
        tests: [not_null]
        meta:
          semantic:
            dimension:
              kind: time
              granularity: day

      - name: date_week
        description: Date truncated to week level
        tests: [not_null]
        meta:
          semantic:
            dimension:
              kind: time
              granularity: week

      - name: date_month
        description: Date truncated to month level
        tests: [not_null]
        meta:
          semantic:
            dimension:
              kind: time
              granularity: month

      # Performance flags
      - name: high_ctr_flag
        description: Flag for high CTR (>= 2%)
        tests: [not_null]
        meta:
          semantic:
            dimension:
              kind: categorical
              note: "Performance indicator flag"

      - name: high_viewability_flag
        description: Flag for high viewability (>= 70%)
        tests: [not_null]
        meta:
          semantic:
            dimension:
              kind: categorical
              note: "Performance indicator flag"

      # Business logic field mapping
      - name: calculated_ctr
        description: CTR renamed from intermediate for business consistency
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}
