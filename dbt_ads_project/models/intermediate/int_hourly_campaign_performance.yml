version: 2

models:
  - name: int_hourly_campaign_performance
    description: |
      Intermediate model for hourly campaign performance with calculated metrics.
      This model adds computed fields to the staging data and serves as the foundation
      for mart models and other downstream transformations.

    columns:
      # Calculated rate fields (0-1 ratios)
      - name: ctr
        description: Click-through rate (clicks/impressions)
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: video_completion_rate
        description: Video completion rate (video_q100/video_start)
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: video_skip_rate
        description: Video skip rate (skips/video_start)
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: video_start_rate
        description: Video start rate (video_start/impressions)
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: viewability_rate
        description: Viewability rate (viewable_impressions/impressions)
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: audibility_rate
        description: Audibility rate (audible_impressions/impressions)
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: win_rate
        description: Auction win rate (auctions_won/eligible_impressions)
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: supply_funnel_efficiency
        description: Supply funnel efficiency (eligible_impressions/requests)
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: fill_rate
        description: Fill rate (auctions_won/eligible_impressions)
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: response_rate
        description: Response rate (responses/requests)
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: error_rate
        description: Error rate (error_count/requests)
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: timeout_rate
        description: Timeout rate (timeout_count/requests)
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: qr_scan_rate
        description: QR scan rate (qr_scans/impressions)
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: interactive_rate
        description: Interactive engagement rate (interactive_engagements/impressions)
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      # Cost metrics
      - name: cpm
        description: Cost per thousand impressions
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg}

      - name: cpc
        description: Cost per click
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg}

      - name: cpv
        description: Cost per video view
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg}

      - name: effective_cpm
        description: Effective CPM in cents
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg}

      # Advanced metrics
      - name: avg_watch_time_seconds
        description: Average watch time in seconds (estimated from quartiles)
        tests: [not_null]
        meta:
          semantic:
            measure: {agg: avg}
