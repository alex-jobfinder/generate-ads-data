version: 2

seeds:
  - name: campaign_performance
    description: |
      Hourly campaign performance seed. Backed by the following DDL:

      ```sql
      CREATE TABLE campaign_performance (
        id INTEGER NOT NULL,
        campaign_id INTEGER NOT NULL,
        hour_ts DATETIME NOT NULL,
        impressions INTEGER NOT NULL,
        clicks INTEGER NOT NULL,
        ctr NUMERIC(5, 4) NOT NULL,
        completion_rate INTEGER NOT NULL,
        render_rate NUMERIC(5, 4) NOT NULL,
        fill_rate NUMERIC(5, 4) NOT NULL,
        response_rate NUMERIC(5, 4) NOT NULL,
        video_skip_rate NUMERIC(5, 4) NOT NULL,
        video_start INTEGER NOT NULL,
        frequency INTEGER NOT NULL,
        reach INTEGER NOT NULL,
        audience_json TEXT,
        requests INTEGER NOT NULL,
        responses INTEGER NOT NULL,
        eligible_impressions INTEGER NOT NULL,
        auctions_won INTEGER NOT NULL,
        viewable_impressions INTEGER NOT NULL,
        audible_impressions INTEGER NOT NULL,
        video_q25 INTEGER NOT NULL,
        video_q50 INTEGER NOT NULL,
        video_q75 INTEGER NOT NULL,
        video_q100 INTEGER NOT NULL,
        skips INTEGER NOT NULL,
        qr_scans INTEGER NOT NULL,
        interactive_engagements INTEGER NOT NULL,
        spend INTEGER NOT NULL,
        error_count INTEGER NOT NULL,
        timeout_count INTEGER NOT NULL,
        human_readable TEXT NOT NULL,
        hour_of_day INTEGER NOT NULL,
        minute_of_hour INTEGER NOT NULL,
        second_of_minute INTEGER NOT NULL,
        day_of_week INTEGER NOT NULL,
        is_business_hour INTEGER NOT NULL,
        PRIMARY KEY (id)
      );
      ```

    config:
      column_types:
        id: INTEGER
        campaign_id: INTEGER
        hour_ts: DATETIME
        impressions: INTEGER
        clicks: INTEGER
        ctr: NUMERIC(5, 4)
        completion_rate: INTEGER
        render_rate: NUMERIC(5, 4)
        fill_rate: NUMERIC(5, 4)
        response_rate: NUMERIC(5, 4)
        video_skip_rate: NUMERIC(5, 4)
        video_start: INTEGER
        frequency: INTEGER
        reach: INTEGER
        audience_json: TEXT
        requests: INTEGER
        responses: INTEGER
        eligible_impressions: INTEGER
        auctions_won: INTEGER
        viewable_impressions: INTEGER
        audible_impressions: INTEGER
        video_q25: INTEGER
        video_q50: INTEGER
        video_q75: INTEGER
        video_q100: INTEGER
        skips: INTEGER
        qr_scans: INTEGER
        interactive_engagements: INTEGER
        spend: INTEGER
        error_count: INTEGER
        timeout_count: INTEGER
        human_readable: TEXT
        hour_of_day: INTEGER
        minute_of_hour: INTEGER
        second_of_minute: INTEGER
        day_of_week: INTEGER
        is_business_hour: INTEGER

    columns:
      - name: id
        description: Surrogate primary key per row
        tests: [not_null, unique]
        meta:
          semantic:
            entity:
              name: performance_record
              type: primary

      - name: campaign_id
        description: Campaign identifier
        tests: [not_null]
        meta:
          semantic:
            entity:
              name: campaign
              type: foreign

      - name: hour_ts
        description: Hour timestamp for the metrics
        tests: [not_null]
        meta:
          semantic:
            dimension:
              kind: time
              granularity: hour
              is_metric_time: true   # maps to global metric_time

      - name: impressions
        description: Total impressions
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: clicks
        description: Total clicks
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: ctr
        description: Click-through rate
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0, max_value: 1}
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: completion_rate
        description: Video completion rate (percentage integer)
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0, max_value: 100}
        meta:
          semantic:
            measure: {agg: avg, scale: "0-100"}

      - name: render_rate
        description: Render rate
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0, max_value: 1}
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: fill_rate
        description: Fill rate
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0, max_value: 1}
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: response_rate
        description: Response rate
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0, max_value: 1}
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: video_skip_rate
        description: Video skip rate
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0, max_value: 1}
        meta:
          semantic:
            measure: {agg: avg, scale: "0-1"}

      - name: video_start
        description: Count of video starts
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: frequency
        description: Average frequency per reached user
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: avg}

      - name: reach
        description: Estimated unique reach
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: audience_json
        description: JSON blob of audience breakdowns
        meta:
          semantic:
            note: "Source for derived audience_* categorical dimensions in semantic_models"

      - name: requests
        description: Total ad requests
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: responses
        description: Total ad responses
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: eligible_impressions
        description: Eligible impressions
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: auctions_won
        description: Auctions won
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: viewable_impressions
        description: Viewable impressions
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: audible_impressions
        description: Audible impressions
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: video_q25
        description: Video at 25%
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: video_q50
        description: Video at 50%
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: video_q75
        description: Video at 75%
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: video_q100
        description: Video at 100%
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: skips
        description: Skip events
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: qr_scans
        description: QR scan events
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: interactive_engagements
        description: Interactive engagement events
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: spend
        description: Spend amount (integer units)
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: error_count
        description: Error count
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: timeout_count
        description: Timeout error count
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0}
        meta:
          semantic:
            measure: {agg: sum}

      - name: human_readable
        description: Human-readable timestamp string
        tests: [not_null]
        meta:
          semantic:
            dimension: {kind: categorical}

      - name: hour_of_day
        description: Hour component (0-23)
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0, max_value: 23}
        meta:
          semantic:
            dimension:
              kind: categorical
              is_partition: true

      - name: minute_of_hour
        description: Minute component (0-59)
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0, max_value: 59}
        meta:
          semantic:
            dimension: {kind: categorical}

      - name: second_of_minute
        description: Second component (0-59)
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0, max_value: 59}
        meta:
          semantic:
            dimension: {kind: categorical}

      - name: day_of_week
        description: Day of week (0-6)
        tests:
          - not_null
          - dbt_utils.accepted_range: {min_value: 0, max_value: 6}
        meta:
          semantic:
            dimension:
              kind: categorical
              is_partition: true

      - name: is_business_hour
        description: Flag if inside business hours
        tests:
          - not_null
          - accepted_values: {values: [0, 1]}
        meta:
          semantic:
            dimension:
              kind: categorical
              is_partition: true
